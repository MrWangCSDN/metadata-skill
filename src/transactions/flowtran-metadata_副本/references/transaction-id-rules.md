# äº¤æ˜“ç éªŒè¯è§„åˆ™

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ flowtran äº¤æ˜“ç çš„æ ¼å¼è§„èŒƒã€éªŒè¯è§„åˆ™å’Œç¤ºä¾‹ã€‚

## äº¤æ˜“ç æ ¼å¼è§„èŒƒ

### åŸºæœ¬æ ¼å¼

**æ ¼å¼**: T + (C/D/G/Y) + 4ä½æ•°å­—(å…±6ä½)

**ç»„æˆ**:
1. å›ºå®šå‰ç¼€: `T`
2. é¢†åŸŸæ ‡è¯†: `C`/`D`/`G`/`Y`
3. æ•°å­—ç¼–ç : 4ä½æ•°å­—

**ç¤ºä¾‹**: `TC021`, `TY001`, `TD250`, `TG350`

### é¢†åŸŸåˆ’åˆ†

| é¢†åŸŸå‰ç¼€ | å®Œæ•´æ ¼å¼ | æ•°å­—èŒƒå›´ | é¢†åŸŸåç§° | ç¤ºä¾‹ |
|---------|---------|---------|---------|------|
| **TC** | TC021-TC999 | 021-999 | å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå­˜æ¬¾é¢†åŸŸ | TC021, TC100, TC999 |
| **TD** | TD001-TD499 | 001-499 | å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒè´·æ¬¾é¢†åŸŸ | TD001, TD100, TD499 |
| **TG** | TG001-TG499 | 001-499 | å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒç»“ç®—é¢†åŸŸ | TG001, TG100, TG499 |
| **TY** | TY001-TY999 | 001-999 | å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå¹³å°å…¬å…±é¢†åŸŸ | TY001, TY291, TY999 |

## è¯¦ç»†éªŒè¯è§„åˆ™

### TC å¼€å¤´ - å­˜æ¬¾é¢†åŸŸ

**è§„åˆ™**: T + C + 021~999 çš„æ•°å­—

**æœ‰æ•ˆèŒƒå›´**:
- æœ€å°å€¼: TC021
- æœ€å¤§å€¼: TC999
- æ€»æ•°é‡: 979 ä¸ªå¯ç”¨ç¼–ç 

**æœ‰æ•ˆç¤ºä¾‹**:
```
âœ… TC021 - æœ€å°æœ‰æ•ˆç¼–ç 
âœ… TC100 - å¸¸ç”¨ç¼–ç 
âœ… TC500 - ä¸­é—´ç¼–ç 
âœ… TC999 - æœ€å¤§æœ‰æ•ˆç¼–ç 
```

**æ— æ•ˆç¤ºä¾‹**:
```
âŒ TC001 - å°äºæœ€å°å€¼ TC021
âŒ TC020 - å°äºæœ€å°å€¼ TC021
âŒ TC1000 - è¶…è¿‡4ä½æ•°å­—
âŒ C021 - ç¼ºå°‘ T å‰ç¼€
âŒ tc100 - å¿…é¡»å¤§å†™
```

### TD å¼€å¤´ - è´·æ¬¾é¢†åŸŸ

**è§„åˆ™**: T + D + 001~499 çš„æ•°å­—

**æœ‰æ•ˆèŒƒå›´**:
- æœ€å°å€¼: TD001
- æœ€å¤§å€¼: TD499
- æ€»æ•°é‡: 499 ä¸ªå¯ç”¨ç¼–ç 

**æœ‰æ•ˆç¤ºä¾‹**:
```
âœ… TD001 - æœ€å°æœ‰æ•ˆç¼–ç 
âœ… TD100 - å¸¸ç”¨ç¼–ç 
âœ… TD250 - ä¸­é—´ç¼–ç 
âœ… TD499 - æœ€å¤§æœ‰æ•ˆç¼–ç 
```

**æ— æ•ˆç¤ºä¾‹**:
```
âŒ TD000 - å°äºæœ€å°å€¼ TD001
âŒ TD500 - è¶…è¿‡æœ€å¤§å€¼ TD499
âŒ TD999 - è¶…è¿‡æœ€å¤§å€¼ TD499
âŒ D100 - ç¼ºå°‘ T å‰ç¼€
```

### TG å¼€å¤´ - ç»“ç®—é¢†åŸŸ

**è§„åˆ™**: T + G + 001~499 çš„æ•°å­—

**æœ‰æ•ˆèŒƒå›´**:
- æœ€å°å€¼: TG001
- æœ€å¤§å€¼: TG499
- æ€»æ•°é‡: 499 ä¸ªå¯ç”¨ç¼–ç 

**æœ‰æ•ˆç¤ºä¾‹**:
```
âœ… TG001 - æœ€å°æœ‰æ•ˆç¼–ç 
âœ… TG100 - å¸¸ç”¨ç¼–ç 
âœ… TG250 - ä¸­é—´ç¼–ç 
âœ… TG499 - æœ€å¤§æœ‰æ•ˆç¼–ç 
```

**æ— æ•ˆç¤ºä¾‹**:
```
âŒ TG000 - å°äºæœ€å°å€¼ TG001
âŒ TG500 - è¶…è¿‡æœ€å¤§å€¼ TG499
âŒ G100 - ç¼ºå°‘ T å‰ç¼€
```

### TY å¼€å¤´ - å¹³å°å…¬å…±é¢†åŸŸ

**è§„åˆ™**: T + Y + 001~999 çš„æ•°å­—

**æœ‰æ•ˆèŒƒå›´**:
- æœ€å°å€¼: TY001
- æœ€å¤§å€¼: TY999
- æ€»æ•°é‡: 999 ä¸ªå¯ç”¨ç¼–ç 

**æœ‰æ•ˆç¤ºä¾‹**:
```
âœ… TY001 - æœ€å°æœ‰æ•ˆç¼–ç 
âœ… TY100 - å¸¸ç”¨ç¼–ç 
âœ… TY291 - å¸¸ç”¨ç¼–ç 
âœ… TY999 - æœ€å¤§æœ‰æ•ˆç¼–ç 
```

**æ— æ•ˆç¤ºä¾‹**:
```
âŒ TY000 - å°äºæœ€å°å€¼ TY001
âŒ TY1000 - è¶…è¿‡4ä½æ•°å­—
âŒ Y291 - ç¼ºå°‘ T å‰ç¼€
```

## éªŒè¯å®ç°

### Python å®ç°

```python
import re
from typing import Tuple

def validate_flowtran_id(trans_id: str) -> Tuple[bool, str]:
    """
    éªŒè¯ flowtran äº¤æ˜“ç æ˜¯å¦ç¬¦åˆè§„èŒƒ
    
    Args:
        trans_id: äº¤æ˜“ç å­—ç¬¦ä¸²
        
    Returns:
        (æ˜¯å¦æœ‰æ•ˆ, æ¶ˆæ¯/é¢†åŸŸåç§°)
    """
    if not trans_id:
        return False, "äº¤æ˜“ç ä¸èƒ½ä¸ºç©º"
    
    if len(trans_id) != 6:
        return False, f"äº¤æ˜“ç å¿…é¡»æ˜¯6ä½å­—ç¬¦,å½“å‰: {len(trans_id)}ä½"
    
    # è½¬æ¢ä¸ºå¤§å†™
    trans_id = trans_id.upper()
    
    # æ£€æŸ¥æ ¼å¼: T + 1ä¸ªå­—æ¯ + 4ä¸ªæ•°å­—
    if not re.match(r'^T[CDGY]\d{4}$', trans_id):
        return False, "äº¤æ˜“ç æ ¼å¼å¿…é¡»æ˜¯: T + C/D/G/Y + 4ä½æ•°å­—"
    
    # æå–é¢†åŸŸå‰ç¼€å’Œæ•°å­—
    prefix = trans_id[1]  # C/D/G/Y
    try:
        num = int(trans_id[2:])  # å4ä½æ•°å­—
    except ValueError:
        return False, "äº¤æ˜“ç å4ä½å¿…é¡»æ˜¯æ•°å­—"
    
    # TC021-TC999
    if prefix == 'C':
        if 21 <= num <= 999:
            return True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå­˜æ¬¾é¢†åŸŸ"
        else:
            return False, f"TCå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TC021-TC999 èŒƒå›´å†…,å½“å‰: TC{num:04d}"
    
    # TD001-TD499
    elif prefix == 'D':
        if 1 <= num <= 499:
            return True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒè´·æ¬¾é¢†åŸŸ"
        else:
            return False, f"TDå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TD001-TD499 èŒƒå›´å†…,å½“å‰: TD{num:04d}"
    
    # TG001-TG499
    elif prefix == 'G':
        if 1 <= num <= 499:
            return True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒç»“ç®—é¢†åŸŸ"
        else:
            return False, f"TGå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TG001-TG499 èŒƒå›´å†…,å½“å‰: TG{num:04d}"
    
    # TY001-TY999
    elif prefix == 'Y':
        if 1 <= num <= 999:
            return True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå¹³å°å…¬å…±é¢†åŸŸ"
        else:
            return False, f"TYå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TY001-TY999 èŒƒå›´å†…,å½“å‰: TY{num:04d}"
    
    else:
        return False, f"äº¤æ˜“ç å¿…é¡»ä»¥ TC/TD/TG/TY å¼€å¤´,å½“å‰: T{prefix}"


def extract_domain_prefix(trans_id: str) -> str:
    """æå–é¢†åŸŸå‰ç¼€ (C/D/G/Y)"""
    trans_id = trans_id.upper()
    if len(trans_id) >= 2 and trans_id[0] == 'T':
        return trans_id[1]
    return ""
```

### JavaScript/TypeScript å®ç°

```typescript
interface ValidationResult {
    valid: boolean;
    message: string;
}

function validateFlowtranId(transId: string): ValidationResult {
    if (!transId) {
        return { 
            valid: false, 
            message: "äº¤æ˜“ç ä¸èƒ½ä¸ºç©º" 
        };
    }
    
    if (transId.length !== 6) {
        return { 
            valid: false, 
            message: `äº¤æ˜“ç å¿…é¡»æ˜¯6ä½å­—ç¬¦,å½“å‰: ${transId.length}ä½` 
        };
    }
    
    // è½¬æ¢ä¸ºå¤§å†™
    transId = transId.toUpperCase();
    
    // æ£€æŸ¥æ ¼å¼
    if (!/^T[CDGY]\d{4}$/.test(transId)) {
        return { 
            valid: false, 
            message: "äº¤æ˜“ç æ ¼å¼å¿…é¡»æ˜¯: T + C/D/G/Y + 4ä½æ•°å­—" 
        };
    }
    
    const prefix = transId[1];  // C/D/G/Y
    const num = parseInt(transId.substring(2));
    
    switch (prefix) {
        case 'C':
            if (num >= 21 && num <= 999) {
                return { 
                    valid: true, 
                    message: "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå­˜æ¬¾é¢†åŸŸ" 
                };
            }
            return { 
                valid: false, 
                message: `TCå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TC021-TC999 èŒƒå›´å†…,å½“å‰: TC${num.toString().padStart(4, '0')}` 
            };
            
        case 'D':
            if (num >= 1 && num <= 499) {
                return { 
                    valid: true, 
                    message: "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒè´·æ¬¾é¢†åŸŸ" 
                };
            }
            return { 
                valid: false, 
                message: `TDå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TD001-TD499 èŒƒå›´å†…,å½“å‰: TD${num.toString().padStart(4, '0')}` 
            };
            
        case 'G':
            if (num >= 1 && num <= 499) {
                return { 
                    valid: true, 
                    message: "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒç»“ç®—é¢†åŸŸ" 
                };
            }
            return { 
                valid: false, 
                message: `TGå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TG001-TG499 èŒƒå›´å†…,å½“å‰: TG${num.toString().padStart(4, '0')}` 
            };
            
        case 'Y':
            if (num >= 1 && num <= 999) {
                return { 
                    valid: true, 
                    message: "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå¹³å°å…¬å…±é¢†åŸŸ" 
                };
            }
            return { 
                valid: false, 
                message: `TYå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TY001-TY999 èŒƒå›´å†…,å½“å‰: TY${num.toString().padStart(4, '0')}` 
            };
            
        default:
            return { 
                valid: false, 
                message: `äº¤æ˜“ç å¿…é¡»ä»¥ TC/TD/TG/TY å¼€å¤´,å½“å‰: T${prefix}` 
            };
    }
}
```

## é”™è¯¯æç¤ºæ¨¡æ¿

### ç¼ºå°‘ T å‰ç¼€

```
âŒ äº¤æ˜“ç éªŒè¯å¤±è´¥: äº¤æ˜“ç å¿…é¡»ä»¥ T å¼€å¤´

å½“å‰: Y291
æ­£ç¡®: TY291

ğŸ’¡ æ­£ç¡®æ ¼å¼: T + C/D/G/Y + 4ä½æ•°å­—
   - TC021-TC999: å­˜æ¬¾é¢†åŸŸ
   - TD001-TD499: è´·æ¬¾é¢†åŸŸ
   - TG001-TG499: ç»“ç®—é¢†åŸŸ
   - TY001-TY999: å¹³å°å…¬å…±é¢†åŸŸ
```

### é¢†åŸŸå‰ç¼€é”™è¯¯

```
âŒ äº¤æ˜“ç éªŒè¯å¤±è´¥: äº¤æ˜“ç å¿…é¡»ä»¥ TC/TD/TG/TY å¼€å¤´

å½“å‰: TX291
æ­£ç¡®ç¤ºä¾‹: TY291

ğŸ’¡ æœ‰æ•ˆçš„é¢†åŸŸå‰ç¼€:
   - TC: å­˜æ¬¾é¢†åŸŸ (C021-C999)
   - TD: è´·æ¬¾é¢†åŸŸ (D001-D499)
   - TG: ç»“ç®—é¢†åŸŸ (G001-G499)
   - TY: å¹³å°å…¬å…±é¢†åŸŸ (Y001-Y999)
```

### æ•°å­—èŒƒå›´é”™è¯¯

```
âŒ äº¤æ˜“ç éªŒè¯å¤±è´¥: TCå¼€å¤´çš„äº¤æ˜“ç å¿…é¡»åœ¨ TC021-TC999 èŒƒå›´å†…

å½“å‰: TC001
æœ€å°å€¼: TC021
æœ€å¤§å€¼: TC999

ğŸ’¡ è¯·ä½¿ç”¨ TC021-TC999 ä¹‹é—´çš„ç¼–ç ,ä¾‹å¦‚:
   âœ… TC021, TC100, TC500, TC999
```

## äº¤æ˜“ç å”¯ä¸€æ€§

### å…¨å±€å”¯ä¸€æ€§è¦æ±‚

- âœ… **å·¥ç¨‹çº§å”¯ä¸€**: æ¯ä¸ªäº¤æ˜“ç åœ¨æ•´ä¸ªå·¥ç¨‹ä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡
- âœ… **æ–‡ä»¶å‘½åä¸€è‡´**: æ–‡ä»¶åå¿…é¡»ä¸äº¤æ˜“ç å¯¹åº”: `{äº¤æ˜“ç }.flowtrans`
- âœ… **è‡ªåŠ¨æ£€æŸ¥**: åˆ›å»ºå‰åœ¨ trans ç›®å½•ä¸‹å…¨å±€æŸ¥æ‰¾,å¦‚å·²å­˜åœ¨åˆ™ä¿®æ”¹

### æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨

```python
import os
from pathlib import Path

def find_flowtran_file(trans_id: str, base_path: str) -> str:
    """åœ¨ trans ç›®å½•ä¸‹å…¨å±€æŸ¥æ‰¾ flowtran æ–‡ä»¶"""
    filename = f"{trans_id}.flowtrans"
    
    # åœ¨ trans ç›®å½•åŠå…¶å­ç›®å½•ä¸‹é€’å½’æŸ¥æ‰¾
    trans_dir = os.path.join(base_path, "src/main/resources/trans")
    
    for root, dirs, files in os.walk(trans_dir):
        if filename in files:
            return os.path.join(root, filename)
    
    return None  # æœªæ‰¾åˆ°


def should_create_or_modify(trans_id: str, base_path: str) -> tuple[str, str]:
    """åˆ¤æ–­åº”è¯¥åˆ›å»ºè¿˜æ˜¯ä¿®æ”¹"""
    existing_file = find_flowtran_file(trans_id, base_path)
    
    if existing_file:
        return "modify", existing_file
    else:
        return "create", None
```

## å¸¸è§é”™è¯¯ç¤ºä¾‹

| é”™è¯¯è¾“å…¥ | åŸå›  | æ­£ç¡®ç¤ºä¾‹ |
|---------|------|---------|
| Y291 | ç¼ºå°‘ T å‰ç¼€ | TY291 |
| ty291 | å°å†™å­—æ¯ | TY291 |
| TC001 | TC èŒƒå›´é”™è¯¯ | TC021 |
| TD500 | TD èŒƒå›´é”™è¯¯ | TD499 |
| TX100 | æ— æ•ˆå‰ç¼€ X | TC100 æˆ– TY100 |
| T100 | ç¼ºå°‘é¢†åŸŸæ ‡è¯† | TC100 |
| TC10 | æ•°å­—ä¸è¶³4ä½ | TC0010 |

## æµ‹è¯•ç”¨ä¾‹

```python
def test_valid_flowtran_ids():
    """æµ‹è¯•æœ‰æ•ˆçš„äº¤æ˜“ç """
    valid_cases = [
        # TC å¼€å¤´
        ("TC021", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå­˜æ¬¾é¢†åŸŸ"),
        ("TC100", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå­˜æ¬¾é¢†åŸŸ"),
        ("TC500", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå­˜æ¬¾é¢†åŸŸ"),
        ("TC999", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå­˜æ¬¾é¢†åŸŸ"),
        
        # TD å¼€å¤´
        ("TD001", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒè´·æ¬¾é¢†åŸŸ"),
        ("TD100", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒè´·æ¬¾é¢†åŸŸ"),
        ("TD250", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒè´·æ¬¾é¢†åŸŸ"),
        ("TD499", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒè´·æ¬¾é¢†åŸŸ"),
        
        # TG å¼€å¤´
        ("TG001", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒç»“ç®—é¢†åŸŸ"),
        ("TG100", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒç»“ç®—é¢†åŸŸ"),
        ("TG250", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒç»“ç®—é¢†åŸŸ"),
        ("TG499", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒç»“ç®—é¢†åŸŸ"),
        
        # TY å¼€å¤´
        ("TY001", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå¹³å°å…¬å…±é¢†åŸŸ"),
        ("TY100", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå¹³å°å…¬å…±é¢†åŸŸ"),
        ("TY291", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå¹³å°å…¬å…±é¢†åŸŸ"),
        ("TY999", True, "å¯¹å…¬åˆ†å¸ƒå¼æ ¸å¿ƒå¹³å°å…¬å…±é¢†åŸŸ"),
    ]
    
    for trans_id, expected_valid, expected_msg in valid_cases:
        is_valid, message = validate_flowtran_id(trans_id)
        assert is_valid == expected_valid, f"Failed for {trans_id}"
        assert message == expected_msg, f"Wrong message for {trans_id}"


def test_invalid_flowtran_ids():
    """æµ‹è¯•æ— æ•ˆçš„äº¤æ˜“ç """
    invalid_cases = [
        # æ ¼å¼é”™è¯¯
        ("", False),                # ç©ºå­—ç¬¦ä¸²
        ("T", False),               # å¤ªçŸ­
        ("TC", False),              # å¤ªçŸ­
        ("TC12", False),            # å¤ªçŸ­
        ("TC12345", False),         # å¤ªé•¿
        
        # å‰ç¼€é”™è¯¯
        ("Y291", False),            # ç¼ºå°‘ T
        ("C021", False),            # ç¼ºå°‘ T
        ("TY", False),              # ç¼ºå°‘æ•°å­—
        ("TX100", False),           # X ä¸æ˜¯æœ‰æ•ˆå‰ç¼€
        
        # TC èŒƒå›´é”™è¯¯
        ("TC001", False),           # å°äº TC021
        ("TC020", False),           # å°äº TC021
        
        # TD èŒƒå›´é”™è¯¯
        ("TD000", False),           # å°äº TD001
        ("TD500", False),           # å¤§äº TD499
        ("TD999", False),           # å¤§äº TD499
        
        # TG èŒƒå›´é”™è¯¯
        ("TG000", False),           # å°äº TG001
        ("TG500", False),           # å¤§äº TG499
        
        # TY èŒƒå›´é”™è¯¯
        ("TY000", False),           # å°äº TY001
    ]
    
    for trans_id, expected_valid in invalid_cases:
        is_valid, _ = validate_flowtran_id(trans_id)
        assert is_valid == expected_valid, f"Failed for '{trans_id}'"
```

## å¿«é€Ÿå‚è€ƒ

### éªŒè¯æµç¨‹æ¸…å•

- [ ] æ£€æŸ¥äº¤æ˜“ç ä¸ä¸ºç©º
- [ ] æ£€æŸ¥é•¿åº¦ä¸º6ä½
- [ ] è½¬æ¢ä¸ºå¤§å†™
- [ ] æ£€æŸ¥æ ¼å¼(T + C/D/G/Y + 4ä½æ•°å­—)
- [ ] æå–é¢†åŸŸå‰ç¼€
- [ ] éªŒè¯æ•°å­—èŒƒå›´
- [ ] è¿”å›éªŒè¯ç»“æœå’Œé¢†åŸŸåç§°
